<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Nimbus Calculator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root {
    color-scheme: dark;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000;
    color: #fff;
  }
  #calculator {
    width: min(420px, 94vw);
    padding: 28px 24px 32px;
    border-radius: 36px;
    background: linear-gradient(160deg, #111 0%, #050505 100%);
    box-shadow: 0 40px 80px rgba(0,0,0,.55);
  }
  .display {
    margin-bottom: 18px;
    text-align: right;
    min-height: 110px;
  }
  #history {
    font-size: 18px;
    color: #888;
    min-height: 24px;
    word-break: break-all;
  }
  #current {
    font-size: clamp(48px, 8vw, 64px);
    font-weight: 300;
    letter-spacing: 1px;
    word-break: break-all;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
  }
  button {
    border: none;
    border-radius: 999px;
    font-size: 26px;
    font-weight: 500;
    padding: 18px 0;
    background: #2a2a2a;
    color: #fff;
    cursor: pointer;
    transition: transform .12s ease, background .2s ease;
  }
  button:active {
    transform: scale(.96);
  }
  .action {
    background: #5c5c5c;
    color: #111;
  }
  .operator {
    background: #ff9f0a;
    color: #111;
    font-weight: 600;
  }
  .wide {
    grid-column: span 2;
  }
</style>
</head>
<body>
  <div id="calculator">
    <div class="display">
      <div id="history"></div>
      <div id="current">0</div>
    </div>
    <div class="grid">
      <button class="action" onclick="clearAll()">AC</button>
      <button class="action" onclick="toggleSign()">±</button>
      <button class="action" onclick="applyPercent()">%</button>
      <button class="operator" onclick="setOperator('÷')">÷</button>

      <button onclick="appendValue('7')">7</button>
      <button onclick="appendValue('8')">8</button>
      <button onclick="appendValue('9')">9</button>
      <button class="operator" onclick="setOperator('×')">×</button>

      <button onclick="appendValue('4')">4</button>
      <button onclick="appendValue('5')">5</button>
      <button onclick="appendValue('6')">6</button>
      <button class="operator" onclick="setOperator('−')">−</button>

      <button onclick="appendValue('1')">1</button>
      <button onclick="appendValue('2')">2</button>
      <button onclick="appendValue('3')">3</button>
      <button class="operator" onclick="setOperator('+')">+</button>

      <button class="wide" onclick="appendValue('0')">0</button>
      <button onclick="appendValue('.')">.</button>
      <button class="operator" onclick="calculate()">=</button>
    </div>
  </div>

<script>
  let expression = '0';
  const currentEl = document.getElementById('current');
  const historyEl = document.getElementById('history');

  function updateDisplays() {
    currentEl.textContent = expression || '0';
  }

  function appendValue(val) {
    if (expression === '0' && val !== '.') expression = '';
    expression += val;
    updateDisplays();
  }

  function setOperator(op) {
    if (/[+−×÷]$/.test(expression)) {
      expression = expression.slice(0, -1) + op;
    } else {
      expression += op;
    }
    updateDisplays();
  }

  function applyPercent() {
    const match = expression.match(/(\d*\.?\d+)$);
    if (!match) return;
    const number = parseFloat(match[1]);
    const percent = number / 100;
    expression = expression.slice(0, -match[1].length) + percent;
    updateDisplays();
  }

  function toggleSign() {
    const match = expression.match(/(\d*\.?\d+)$);
    if (!match) return;
    const number = parseFloat(match[1]) * -1;
    expression = expression.slice(0, -match[1].length) + number;
    updateDisplays();
  }

  function clearAll() {
    expression = '0';
    historyEl.textContent = '';
    updateDisplays();
  }

  function calculate() {
    try {
      const sanitized = sanitize(expression);
      const result = evalExpression(sanitized);
      historyEl.textContent = expression;
      expression = String(result);
      updateDisplays();
    } catch (e) {
      showError();
    }
  }

  function sanitize(exp) {
    if (!/^[0-9.+−×÷\s]+$/.test(exp)) throw new Error('Invalid characters');
    return exp.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');
  }

  function evalExpression(exp) {
    const fn = new Function(`return (${exp})`);
    const result = fn();
    if (!isFinite(result)) throw new Error('Invalid math');
    return result;
  }

  function showError() {
    historyEl.textContent = 'Error';
    expression = '0';
    updateDisplays();
  }
</script>
</body>
</html>
