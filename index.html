<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Nimbus Calculator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root {
    color-scheme: dark;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000;
    color: #fff;
  }
  #calculator {
    width: min(420px, 94vw);
    padding: 28px 24px 32px;
    border-radius: 36px;
    background: linear-gradient(160deg, #111 0%, #050505 100%);
    box-shadow: 0 40px 80px rgba(0,0,0,.55);
  }
  .display {
    margin-bottom: 18px;
    text-align: right;
  }
  #history {
    font-size: 16px;
    color: #888;
    min-height: 24px;
    word-break: break-all;
  }
  #current {
    width: 100%;
    border: none;
    background: transparent;
    color: #fff;
    font-size: clamp(48px, 8vw, 64px);
    font-weight: 300;
    text-align: right;
  }
  #current:focus {
    outline: none;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
  }
  button {
    border: none;
    border-radius: 999px;
    font-size: 26px;
    font-weight: 500;
    padding: 18px 0;
    background: #2a2a2a;
    color: #fff;
    cursor: pointer;
    transition: transform .12s ease, background .2s ease;
  }
  button:active {
    transform: scale(.96);
  }
  .action {
    background: #5c5c5c;
    color: #111;
  }
  .operator {
    background: #ff9f0a;
    color: #111;
    font-weight: 600;
  }
  .wide {
    grid-column: span 2;
  }
</style>
</head>
<body>
  <div id="calculator">
    <div class="display">
      <div id="history"></div>
      <input id="current" value="0" readonly />
    </div>
    <div class="grid">
      <button class="action" onclick="clearAll()">AC</button>
      <button class="action" onclick="toggleSign()">±</button>
      <button class="action" onclick="applyPercent()">%</button>
      <button class="operator" onclick="handleOperator('÷')">÷</button>

      <button onclick="inputDigit('7')">7</button>
      <button onclick="inputDigit('8')">8</button>
      <button onclick="inputDigit('9')">9</button>
      <button class="operator" onclick="handleOperator('×')">×</button>

      <button onclick="inputDigit('4')">4</button>
      <button onclick="inputDigit('5')">5</button>
      <button onclick="inputDigit('6')">6</button>
      <button class="operator" onclick="handleOperator('−')">−</button>

      <button onclick="inputDigit('1')">1</button>
      <button onclick="inputDigit('2')">2</button>
      <button onclick="inputDigit('3')">3</button>
      <button class="operator" onclick="handleOperator('+')">+</button>

      <button class="wide" onclick="inputDigit('0')">0</button>
      <button onclick="inputDecimal()">.</button>
      <button class="operator" onclick="performCalculation()">=</button>
    </div>
  </div>

<script>
  let displayValue = '0';
  let firstOperand = null;
  let operator = null;
  let waitingForSecondOperand = false;
  const historyEl = document.getElementById('history');
  const displayEl = document.getElementById('current');

  function updateDisplay() {
    displayEl.value = displayValue;
  }

  function inputDigit(digit) {
    if (waitingForSecondOperand) {
      displayValue = digit;
      waitingForSecondOperand = false;
    } else {
      displayValue = displayValue === '0' ? digit : displayValue + digit;
    }
    updateDisplay();
  }

  function inputDecimal() {
    if (waitingForSecondOperand) {
      displayValue = '0.';
      waitingForSecondOperand = false;
      updateDisplay();
      return;
    }
    if (!displayValue.includes('.')) {
      displayValue += '.';
      updateDisplay();
    }
  }

  function clearAll() {
    displayValue = '0';
    firstOperand = null;
    operator = null;
    waitingForSecondOperand = false;
    historyEl.textContent = '';
    updateDisplay();
  }

  function toggleSign() {
    displayValue = String(parseFloat(displayValue) * -1 || 0);
    updateDisplay();
  }

  function applyPercent() {
    displayValue = String(parseFloat(displayValue) / 100 || 0);
    updateDisplay();
  }

  function handleOperator(nextOperator) {
    const inputValue = parseFloat(displayValue);
    if (operator && waitingForSecondOperand) {
      operator = nextOperator;
      historyEl.textContent = `${firstOperand} ${operator}`;
      return;
    }
    if (firstOperand === null && !isNaN(inputValue)) {
      firstOperand = inputValue;
    } else if (operator) {
      const result = performOperation(firstOperand, inputValue, operator);
      displayValue = String(result);
      firstOperand = result;
    }
    waitingForSecondOperand = true;
    operator = nextOperator;
    historyEl.textContent = `${firstOperand} ${operator}`;
    updateDisplay();
  }

  function performOperation(first, second, op) {
    switch (op) {
      case '+': return first + second;
      case '−': return first - second;
      case '×': return first * second;
      case '÷': return second === 0 ? 'Error' : first / second;
      default: return second;
    }
  }

  function performCalculation() {
    if (operator === null || waitingForSecondOperand) return;
    const secondOperand = parseFloat(displayValue);
    const result = performOperation(firstOperand, secondOperand, operator);
    historyEl.textContent = `${firstOperand} ${operator} ${secondOperand} =`;
    displayValue = String(result);
    firstOperand = result === 'Error' ? null : result;
    operator = null;
    waitingForSecondOperand = false;
    updateDisplay();
  }

  updateDisplay();
</script>
</body>
</html>
